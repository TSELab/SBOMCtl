FROM debian:stable-slim
ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update && apt-get install -y \
    python3 python3-pip python3-venv \
    build-essential \
    rustc cargo \
    git \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*


WORKDIR /evaluation

# Copy the build context into the image
COPY . /evaluation

WORKDIR /evaluation/privateSBOMExchange
RUN python3 -m venv /opt/venv
ENV VIRTUAL_ENV=/opt/venv
ENV PATH="$VIRTUAL_ENV/bin:$PATH"
RUN pip install --no-cache-dir -r requirements.txt


WORKDIR /evaluation/privateSBOMExchange/src/cpabe
RUN maturin develop

WORKDIR /evaluation/sbom_data
RUN git submodule init bom-shelter
RUN git submodule update

WORKDIR /evaluation/privateSBOMExchange
RUN pip3 install -e .

CMD ["/bin/bash"]
